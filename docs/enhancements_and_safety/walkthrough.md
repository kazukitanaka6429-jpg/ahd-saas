# 変更確認 (Walkthrough)

## 1. 安全な削除機能の展l
全ての管理者画面において、削除時のUIと監査ログを統一しました。
- **対象**: 利用者、スタッフ、資格、施設
- **機能**:
  - 共通の削除ボタン (`DeleteButton`) を使用。
  - 削除前に確認ダイアログを表示。
  - サーバーサイドで実行者と対象IDを `logger.warn` で記録。

## 2. 医療連携体制加算Ⅴの改善
UIの刷新とパフォーマンス最適化を行いました。
- **UIテーマ**:
  - ベースカラーを `Slate` (ネイビー/グレー) に変更し、信頼感を向上。
  - アクション（未保存状態など）に `Amber` (オレンジ) を使用し、視認性を向上。
- **パフォーマンス**:
  - `MedicalVRow` コンポーネントを切り出し、`React.memo` でメモ化。
  - 1つのセルを更新しても、他の行が再レンダリングされないように最適化。

## 3. 利用者並び順の統一
全ての主要機能において、利用者の並び順を「表示ID順 (`display_id`)」に統一しました。
- **対象**:
  - 業務日誌
  - 医療連携
  - 医療連携Ⅴ
  - 本社チェック機能

## 4. 施設切り替え機能の実装と修正
法人内の複数施設をスムーズに切り替えられる機能を追加し、表示の不具合を修正しました。
- **対象画面**:
  - 業務日誌
  - 医療連携体制加算 (IV)
  - 医療連携体制加算Ⅴ
  - **[NEW]** 本社日次確認画面
- **機能**:
  - 画面ヘッダーに施設名と切り替えドロップダウンを表示。
  - **[修正]**: 業務日誌でタイトルが重複して表示されていた問題を修正。
  - **[修正]**: Admin権限を持つユーザーであれば、所属施設の設定に関わらず全施設の切り替えができるように権限ロジックを修正。
  - **[修正]**: Adminユーザーが施設を切り替えた際、URLで指定した施設のデータが正しく優先表示されるように、データ取得ロジック（ページ側・サーバー側）を修正。

### 本社日次確認画面の対応
- これまで施設切り替え機能が未実装だったため、新規施設が表示されない問題がありました。
- `FacilitySwitcher` を追加し、選択した施設のデータ（マトリクスおよび滞在期間データ）が正しく表示されるように修正しました。
- **[NEW] 全施設表示対応**: 施設を指定しない（デフォルト）の状態で、Adminユーザーは組織内の全ての施設のデータをまとめて閲覧できるようになりました。
- **[UI改善]**: 機能が重複していたヘッダーの施設切り替えボタンを削除し、内部のフィルタリング機能に一本化しました。これに伴い、CSVインポート時に施設を選択できるようにドロップダウンを追加しました。

<div style="text-align: center;">
※ 変更は既に環境に適用されています。
</div>
