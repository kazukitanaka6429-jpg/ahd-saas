# 通知システム実装ウォークスルー (詳細版)

## 概要
本部（管理者）と施設（スタッフ）間の双方向通知システムを実装しました。

## 1. 本部から施設への通知
**目的**: 本部が「指摘」を作成した際、施設スタッフに通知する。
- **バックエンド**: `app/actions/findings.ts` の `addFindingComment` を更新。
- **ロジック**:
    -   `staff.role === 'admin'` (管理者) がコメントを追加した際...
    -   システムがレコードから対象の `facility_id` を特定。
    -   その施設に対して「本部から指摘がありました」という**警告 (Warning)** レベルの通知を送信。

## 2. 施設から本部への通知
**目的**: 施設スタッフが回答、または指摘を解決した際、本部管理者に通知する。
- **バックエンド**: `app/actions/system-notifications.ts` に `notifyOrganizationAdmins` を追加。
- **ロジック**:
    -   `staff.role !== 'admin'` (非管理者) がコメントを追加した際...
        -   同じ組織の**全管理者**に対し、ユーザーID指定で通知。
        -   メッセージ: "施設から回答がありました"
    -   `staff.role !== 'admin'` (非管理者) がステータスを「解決済み」にした際...
        -   同じ組織の**全管理者**に通知。
        -   メッセージ: "指摘が解決済みになりました"

## 検証済みシナリオ
- [x] 管理者がコメント追加 -> スタッフが通知を確認できる。
- [x] スタッフが回答 -> 全管理者が通知を確認できる。
- [x] スタッフが解決 -> 全管理者が通知を確認できる。

## 主な変更ファイル
- `app/actions/findings.ts`
- `app/actions/system-notifications.ts`
