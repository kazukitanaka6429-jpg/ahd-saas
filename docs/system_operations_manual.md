# Yorisol システム完全運用マニュアル（拡張版）

このマニュアルは、エンジニアが不在でも、新入社員とAI（ChatGPT/Claude/Gemini等）だけでシステムを復旧・運用し続けるためのガイドラインです。

---

## 1. 緊急トラブルシューティング

### ケースA: 画面が真っ白になった / 「予期せぬエラー」の赤い画面が出た

これはシステムが「お手上げ」状態になった時に表示される緊急画面です。慌てずに以下の手順を行ってください。

**▼ 手順**
1. 画面に表示されている「**開発者用デバッグ情報を表示**」という小さなリンクをクリックします（画面下部にあります）。
2. 黒いボックスが表示され、英語の文字が大量に出てきます。
3. その黒いボックスの右上に「**コピーアイコン（四角が重なったマーク）**」があるので、それをクリックします。
   ※これで、エラーの詳細情報がクリップボードにコピーされました。
4. AIチャットを開き、【テンプレートA】を貼り付けて送信してください。

---

### ケースB: 「保存に失敗しました」「予期せぬエラー」という通知が出た

データの保存ボタンを押した時に、画面右上に赤い通知が出る場合です。

**▼ 手順**
1. 通知に表示されているメッセージをメモしてください（例：「権限がありません」「予期せぬエラーが発生しました」）。
2. 「**いつ**」「**誰が**」「**どの画面で**」「**何をしようとしたか**」を具体的に記録します。
3. AIチャットを開き、【テンプレートB】を貼り付けて送信してください。

---

### ケースC: ログインできない 🆕

ログイン画面でメールアドレス・パスワードを入力してもログインできない場合です。

**▼ まず確認すること**
| 症状 | 原因の可能性 | 対処法 |
|------|-------------|--------|
| 「認証情報が無効です」と表示 | パスワード間違い | パスワードリセットを依頼 |
| 何も起きない・ずっとローディング | ネットワーク問題 | インターネット接続を確認 |
| 「ユーザーが見つかりません」 | アカウント未作成 | 管理者に招待リンク発行を依頼 |
| 以前はログインできたのに急にできない | セッション切れ | ブラウザのキャッシュをクリア |

**▼ パスワードリセット手順**
1. ログイン画面の「**パスワードを忘れた方**」リンクをクリック
2. メールアドレスを入力して送信
3. 届いたメールのリンクから新しいパスワードを設定

**▼ キャッシュクリア手順（Chrome）**
1. `Ctrl + Shift + Delete` を押す
2. 「Cookieと他のサイトデータ」にチェック
3. 「データを削除」をクリック
4. 再度ログインを試す

---

### ケースD: データが表示されない（一覧が空っぽ） 🆕

利用者一覧や業務日誌など、本来データがあるはずなのに「データがありません」と表示される場合です。

**▼ まず確認すること**
| 症状 | 原因の可能性 | 対処法 |
|------|-------------|--------|
| 自分だけ見えない | 権限不足 | 管理者に権限確認を依頼 |
| 特定の施設だけ見えない | 施設切り替え未選択 | ヘッダーの施設選択を確認 |
| 昨日まで見えていたのに急に見えない | システム障害の可能性 | 【テンプレートD】でAIに相談 |
| 新しく追加したデータだけ見えない | 保存失敗の可能性 | もう一度データを登録してみる |

**▼ 施設切り替えの確認**
1. 画面上部のヘッダーに「施設名」が表示されているか確認
2. 正しい施設が選択されているか確認
3. 管理者の場合「全施設」を選択すると全てのデータが表示されます

---

### ケースE: 保存はできたが画面に反映されない 🆕

「保存しました」と表示されたのに、一覧に戻ると変更が反映されていない場合です。

**▼ 対処法**
1. **ブラウザを再読み込み**（`F5` キー または `Ctrl + R`）
2. それでも反映されない場合は **強制再読み込み**（`Ctrl + Shift + R`）
3. まだ反映されない場合は **別のタブで同じ画面を開く**
4. 改善しない場合は【テンプレートE】でAIに相談

---

### ケースF: 画面の表示が崩れている 🆕

ボタンが重なっている、レイアウトがおかしい、文字が見切れているなどの場合です。

**▼ 対処法**
1. **ブラウザのズームを確認**（`Ctrl + 0` で100%にリセット）
2. **ブラウザを最新版にアップデート**
3. **別のブラウザで試す**（Chrome推奨）
4. 改善しない場合は【テンプレートC】でAIに相談

---

## 2. AIへの指示テンプレート集

以下の文章をそのままコピーし、`[ ]` の部分だけ状況に合わせて書き換えてAIに送信してください。

### 【テンプレートA】重大なエラー（画面が真っ白）の修正依頼

```
システムを利用中に「予期せぬエラー」画面が表示されました。
エンジニアが不在のため、原因の特定と修正方法を教えてください。

以下はエラー画面からコピーしたデバッグ情報です：

--- ここにコピーしたエラー情報を貼り付け ---

【依頼内容】
1. 何が原因で起きたエラーですか？（素人にもわかるように）
2. システムのコードのどこを直せば治りますか？修正案のコードを提示してください。
```

---

### 【テンプレートB】機能エラー（保存失敗など）の相談

```
システムの利用中にエラーが発生しました。修正をお願いします。

【発生状況】
- 発生日時: [例: 2024/01/10 10:00]
- 作業者: [例: 鈴木太郎（管理者アカウント）]
- 画面: [例: 業務日誌画面]
- 操作: [例: 「一括保存」ボタンを押した]
- 表示されたエラー: [例: 「予期せぬエラーが発生しました」]

【AIへの依頼】
このシステムのサーバーアクションには `logger.error` が仕込まれています。
私が提供できるログ情報はありませんが、コード上の「どの処理」で失敗している可能性が高いか推測し、
原因調査のために確認すべきコード箇所と、修正候補を提示してください。
```

---

### 【テンプレートC】文言やデザインの微修正

```
システムの画面表示を少し変更したいです。

【変更したい画面】
- [例: 職員登録画面]

【依頼内容】
現在の「[例: 資格ID]」という表示を、「[例: 保有資格]」に変更したいです。
また、入力欄の横幅をもう少し広げることは可能ですか？

該当するファイル（tsxファイル）を探し出し、変更後のコードを教えてください。
```

---

### 【テンプレートD】データが表示されない問題の調査 🆕

```
システムで本来表示されるべきデータが表示されません。

【発生状況】
- 発生日時: [例: 2024/01/10 10:00]
- 作業者: [例: 鈴木太郎]
- 権限: [例: 管理者 / 一般スタッフ]
- 画面: [例: 利用者一覧]
- 症状: [例: 一覧が空っぽで「データがありません」と表示される]
- 他のスタッフは見えているか: [例: 確認中 / 他の人も見えない]

【AIへの依頼】
1. RLS（Row Level Security）の問題かどうか判断してください
2. 原因として考えられる箇所を教えてください
3. 確認・修正すべきコードを提示してください
```

---

### 【テンプレートE】データが反映されない問題の調査 🆕

```
システムでデータを保存しましたが、画面に反映されません。

【発生状況】
- 発生日時: [例: 2024/01/10 10:00]
- 画面: [例: 業務日誌]
- 操作: [例: 利用者の食事データを入力して保存ボタンを押した]
- 結果: [例: 「保存しました」と表示されたが、再読み込みすると消えている]

【AIへの依頼】
1. revalidatePath の漏れがないか確認してください
2. キャッシュの問題かどうか判断してください
3. 修正が必要な場合はコードを提示してください
```

---

## 3. 運用・保守の心得（新入社員のあなたへ）

このシステムは「**壊れにくい（堅牢）**」ように作られていますが、絶対に壊れないわけではありません。
しかし、以下の武器がすでに埋め込まれています。

| 武器 | 説明 |
|------|------|
| **Protect（守り）** | 権限のない人が間違ってデータを消そうとしても、システムが自動でブロックします |
| **Logger（記録）** | 何かあった時、システムは密かに「何が起きたか」を記録しています |
| **Global Error（命綱）** | 画面が壊れても、必ず「デバッグ情報」を表示してくれます |

あなたがプログラミングができなくても、「**エラー情報を正確にAIに伝える**」ことさえできれば、AIが優秀なエンジニアとして解決策を提示してくれます。
このマニュアルを武器に、自信を持って運用してください。

---

## 4. AIからもらった修正の適用手順（治療編）

### 4.1. Cursorの「Composer（AI修正機能）」の使い方

AIから「修正後のコード」を受け取ったら、以下の手順でシステムに適用してください。

1. **修正したいファイルを開く**
   - Cursorの左側のファイルツリーから、AIが指定したファイル（例: `app/actions/resident.ts`）をクリックして開きます。

2. **Composer を開く**
   - キーボードの `Ctrl + I`（Macの人は `Cmd + I`）を押します。
   - 画面の中央または右側に、AI入力欄が表示されます。

3. **修正指示を貼り付ける**
   - AIから教えてもらった修正点やコードを、そのままComposerの入力欄に貼り付けます。
   - 例: 「app/actions/resident.ts の getResidents 関数を以下のコードに置き換えてください:（コード貼り付け）」
   - `Enter` キーを押すと、AIが自動でコードを書き換え始めます。

4. **確認と適用 (Accept)**
   - 修正された箇所が緑色や赤色で表示されます。
   - 内容が良さそうなら、`Accept` ボタン（または `Cmd + Enter`）を押して確定します。
   - 最後に `Ctrl + S`（Macの人は `Cmd + S`）でファイルを保存してください。

---

### 4.2. 修正内容の反映（デプロイ）

コードを直して保存しただけでは、インターネット上の「本番システム」には反映されません。以下の「手紙を出す」ような作業が必要です。

1. **Source Control を開く**
   - Cursorの画面左端にあるアイコンの中から、「**枝分かれした線（Yの字のようなマーク）**」をクリックします。

2. **変更内容のコミット (Commit)**
   - 入力欄（Message Box）に、「何をしたか」を一言で入力します。
   - 入力例: `AI修正: エラー対応` や `文言修正`
   - 入力したら、その上の「**Commit**」ボタン（またはチェックマーク）をクリックします。

3. **変更内容のプッシュ (Push)**
   - 「**Sync Changes**」または「**Push**」というボタンが表示されるので、それをクリックします。
   - これで修正内容がクラウド（GitHub等）に送信され、数分後には自動的に本番システムが更新されます。

> ⚠️ **注意：すぐには直りません**
> 「Push」ボタンを押してから、本番システムに反映されるまで **約3〜5分** かかります。
> 5分待ってから画面を再読み込みし、エラーが消えたか確認してください。

---

## 5. Vercel管理画面の使い方 🆕

Vercel（バーセル）は、このシステムが動いている「サーバー」を管理する画面です。

### 5.1. Vercelへのアクセス

1. [vercel.com](https://vercel.com) にアクセス
2. GitHubアカウントでログイン
3. プロジェクト一覧から「yorisol」または該当プロジェクトをクリック

### 5.2. デプロイ状況の確認

| タブ | 確認できること |
|------|---------------|
| **Deployments** | 過去のデプロイ履歴。最新が「Ready」なら正常 |
| **Logs** | システムのログ（エラー発生時に確認） |
| **Settings → Environment Variables** | 環境変数（パスワード類）の設定 |

### 5.3. デプロイが失敗した場合

1. **Deployments** タブを開く
2. 赤い「Error」となっているデプロイをクリック
3. **Build Logs** を確認
4. エラーメッセージをコピーして【テンプレートA】でAIに相談

---

## 6. Supabase管理画面の使い方（読み取り専用） 🆕

Supabase（スーパーベース）は、このシステムのデータベースを管理する画面です。

> ⚠️ **重要**: データの閲覧のみ行ってください。編集・削除は禁止です。

### 6.1. Supabaseへのアクセス

1. [supabase.com](https://supabase.com) にアクセス
2. アカウントでログイン
3. プロジェクト一覧から該当プロジェクトをクリック

### 6.2. データの確認方法

1. 左メニューの「**Table Editor**」をクリック
2. 確認したいテーブル（例: `residents`, `staffs`）をクリック
3. データが一覧表示されます

### 6.3. 確認してよいテーブル

| テーブル名 | 内容 |
|-----------|------|
| `residents` | 利用者データ |
| `staffs` | スタッフデータ |
| `facilities` | 施設データ |
| `daily_records` | 業務日誌データ |

### 6.4. ログの確認

1. 左メニューの「**Logs**」をクリック
2. 「**Postgres**」を選択
3. エラーが発生している場合、ここにログが表示されます

---

## 7. これだけは触るな（禁止事項）

以下のファイルやフォルダは、システムの心臓部です。AIに指示されたとしても、エンジニアの確認なしに絶対に触らないでください。

| 禁止項目 | 理由 |
|---------|------|
| ❌ `.env` ファイル | パスワードなどが書かれています |
| ❌ `supabase/` フォルダ | データベースの設定です |
| ❌ `package.json` | システムの構成部品リストです |
| ❌ Supabaseでのデータ編集 | 誤操作でデータが壊れます |
| ❌ Vercelの環境変数削除 | システムが動かなくなります |

これらを書き換える指示が出た場合は、必ず専門のエンジニアに相談してください。

---

## 8. 定期確認チェックリスト 🆕

週に1回、以下を確認してください。

### 毎週月曜日の確認

- [ ] システムにログインできるか
- [ ] 業務日誌が正常に表示されるか
- [ ] 利用者一覧が正常に表示されるか
- [ ] Vercelのデプロイ状況が「Ready」か

### 月に1回の確認

- [ ] Supabaseのプロジェクトが正常か（ダッシュボードにアクセスできるか）
- [ ] スタッフのログイン状況（長期間ログインしていない人がいないか）

---

## 9. 緊急連絡先

| 状況 | 連絡先 |
|------|--------|
| システムが完全に動かない | [エンジニア連絡先を記入] |
| データが消えた・おかしい | [エンジニア連絡先を記入] |
| セキュリティ問題（不正アクセス等） | [エンジニア連絡先を記入] |

---

*最終更新: 2026年1月11日*
